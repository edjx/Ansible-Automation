name: Test Action

on:
  push:
    branches:
      - master
  pull_request:

jobs:
  test-remote:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Setup remote
        run: |
          echo "${{secrets.SSH_PUBLIC_KEY}}" | sudo tee /etc/ssh/authorized_keys
          sudo tee /etc/ssh/sshd_config <<EOF
            PasswordAuthentication no
            PubkeyAuthentication yes
            AuthorizedKeysFile /etc/ssh/authorized_keys
            PermitRootLogin no
            Subsystem sftp /usr/lib/openssh/sftp-server
          EOF
          sudo systemctl restart sshd
      - name: Test remote
        uses: ./
        with:
          playbook: sa.yml
          directory: /etc/ansible
          key: ${{secrets.ANSIBLE}}
          inventory: |
            [all]
            34.123.67.156
